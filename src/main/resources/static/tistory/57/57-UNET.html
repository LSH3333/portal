
<meta charset="utf-8">
<html lang="ko">
<head>
    <link rel="stylesheet" type="text/css" href="./../style.css" />
    <title>UNET</title>
</head>
<body id="tt-body-page" class="">
<div id="wrap" class="wrap-right">
    <div id="container">
        <main class="main ">
            <div class="area-main">
                <div class="area-view">
                    <div class="article-header">
                        <div class="inner-article-header">
                            <div class="box-meta">
                                <h2 class="title-article">UNET</h2>
                                <div class="box-info">
                                    <p class="category">유니티</p>
                                    <p class="date">2020-12-27 12:23:16</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <hr>
                    <div class="article-view">
                        <div class="contents_style">
                            <p>* Unet은 현재 Unity에서 지원하지 않음.</p>
<p>따라서 직접 패키지 설치필요.</p>
<p>&nbsp;</p>
<p>Window - Package Manager - 좌측상단 + 버튼 - Add Package from git URL - <span>com.unity.multiplayer-hlapi</span></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><b>Network</b></p>
<p>네트워크 사용위해서는 Game Object에 <b>Network Manager</b> 컴포넌트 추가.</p>
<p><span style="color: #333333;"><b>Network HUD</b> 추가.</span></p>
<p><figure class="imageblock alignCenter" data-filename="20201231174321.png" data-origin-width="391" data-origin-height="566" data-ke-mobilestyle="widthContent">
    <span data-lightbox="lightbox">
        <img src="./img/img.png" data-filename="20201231174321.png" data-origin-width="391" data-origin-height="566" data-ke-mobilestyle="widthContent" />
    </span>
    <figcaption></figcaption>
</figure></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><b>NetworkBehaviour 상속</b></p>
<pre id="code_1609404954323" class="cs" data-ke-language="cs" data-ke-type="codeblock"><code>using UnityEngine;
using UnityEngine.Networking;

public class Player : NetworkBehaviour {
    private const float Speed = 6f;
    private const float Rotspeed = 100f;

    void Update()
    {
        if (!isLocalPlayer) return; // 즉 Local player 아니라면 무시.

        float h = Input.GetAxis("Horizontal") * Rotspeed * Time.deltaTime;
        float v = Input.GetAxis("Vertical") * Speed * Time.deltaTime;

        transform.Rotate(0, h, 0);
        transform.Translate(0, 0, v);
    }
}
</code></pre>
<p>NetworkBehaviour 상속받고 if (!isLocalplayer) 즉 로칼플레이어가 아니라면 리턴해줘야 나의 오브젝트만 움직인다.</p>
<p>이렇게 하지 않으면 호스트, 클라이언트 즉 두개의 오브젝트가 있을때 키보드 눌렀을때 둘 다 동시에 움직임. (즉 버그)</p>
<p>&nbsp;</p>
<p><figure class="imageblock alignCenter" data-filename="20201231180233.png" data-origin-width="1006" data-origin-height="730" width="509" height="NaN" data-ke-mobilestyle="widthContent">
    <span data-lightbox="lightbox">
        <img src="./img/img_1.png" data-filename="20201231180233.png" data-origin-width="1006" data-origin-height="730" width="509" height="NaN" data-ke-mobilestyle="widthContent" />
    </span>
    <figcaption>키보드 누르면 자신의 개체만 움직임</figcaption>
</figure></p>
<p>&nbsp;</p>
<p><b>Network Transform</b></p>
<p>Network Identity 를 가지는 오브젝트의 Transform을 <b>동기화</b> 시킴.</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><b>Network Object</b> : local 에서 뿐만 아니라 모든 네트워크에서 나타나야 하는 Object.</p>
<p>&nbsp;</p>
<p>A, B 컴퓨터가 있을때, B 컴퓨터에서 오브젝트를 생성시킨다고 하면, B에서 직접 생성이 아닌 서버(A컴퓨터)에게 생성해달라고 부탁하는 방식.</p>
<p>&nbsp;</p>
<p>- Network Object는 네트워크 상에서 존재감을 가져야하므로</p>
<p><b>Network Identity</b>를 component로 가져야함.&nbsp;</p>
<p>&nbsp;Network Identity의 Local Player Authority를 체크하면 이 으보젝트를 소유한 클라이언트가 오브젝트를 제어 가능.</p>
<p><figure class="imageblock alignCenter" data-filename="20201231183835.png" data-origin-width="370" data-origin-height="63" data-ke-mobilestyle="widthContent">
    <span data-lightbox="lightbox">
        <img src="./img/img_2.png" data-filename="20201231183835.png" data-origin-width="370" data-origin-height="63" data-ke-mobilestyle="widthContent" />
    </span>
    <figcaption></figcaption>
</figure></p>
<p>&nbsp;</p>
<p>- Network Object는 서버(호스트)에서&nbsp;</p>
<p>그냥 Instantiate가 아닌 <b>NetworkSever.Spawn&nbsp;</b>으로 오브젝트 생성.</p>
<p>&nbsp;</p>
<p>- 클라이언트에 전달되어야할 명령으로서 함수는 <b>[Command]</b> 속성을 갖고, Cmd~~ 로 시작됨.&nbsp;</p>
<p>[Command] 함수는 자신이 해당 함수를 직접 호출하지않고, Host에게 호출해 달라고 요청함.</p>
<p>&nbsp;</p>
<pre id="code_1609038313263" class="cs" data-ke-language="cs" data-ke-type="codeblock"><code>using UnityEngine;
using UnityEngine.Networking;

public class Player : NetworkBehaviour {

    ...
    
    private void Update()
    {
        ... 
        
        if(Input.GetMouseButtonDown(0))
        {
            CmdCreateBox();
        }
    }

    [Command]
    void CmdCreateBox()
    {
        GameObject box = Instantiate(_box, transform.position, Quaternion.identity);
        box.GetComponent&lt;Rigidbody&gt;().velocity = transform.forward * 20f;
    }
}
</code></pre>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p><b>모든 값의 동기화 :&nbsp;&nbsp;</b>모든 네트워크에서 값이 동기화되어야 할때</p>
<p><b>[SyncVar(hook = "OnChangeCount")]</b></p>
<p>int count = 0;</p>
<p>&nbsp;</p>
<p>// hook : 해당 변수 변화 생기면 명시한 함수 자동 호출함.</p>
                        </div>
                        <br/>
                        <div class="tags">
                            #Unity 
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
</div>
</body>
</html>
