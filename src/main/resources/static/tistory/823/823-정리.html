
<meta charset="utf-8">
<html lang="ko">
<head>
    <link rel="stylesheet" type="text/css" href="./../style.css" />
    <title>정리</title>
</head>
<body id="tt-body-page" class="">
<div id="wrap" class="wrap-right">
    <div id="container">
        <main class="main ">
            <div class="area-main">
                <div class="area-view">
                    <div class="article-header">
                        <div class="inner-article-header">
                            <div class="box-meta">
                                <h2 class="title-article">정리</h2>
                                <div class="box-info">
                                    <p class="category">Web</p>
                                    <p class="date">2022-07-28 21:38:35</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <hr>
                    <div class="article-view">
                        <div class="contents_style">
                            <p data-ke-size="size16"><a href="https://github.com/LSH3333/spring5fs" target="_blank" rel="noopener">https://github.com/LSH3333/spring5fs</a></p>
<figure id="og_1659008797287" contenteditable="false" data-ke-type="opengraph" data-ke-align="alignCenter" data-og-type="object" data-og-title="GitHub - LSH3333/spring5fs: 스프링5 프로그래밍 입문 (최범균 저)" data-og-description="스프링5 프로그래밍 입문 (최범균 저) . Contribute to LSH3333/spring5fs development by creating an account on GitHub." data-og-host="github.com" data-og-source-url="https://github.com/LSH3333/spring5fs" data-og-url="https://github.com/LSH3333/spring5fs" data-og-image="https://scrap.kakaocdn.net/dn/bqvx9S/hyPeJVy1K8/PIsD4YzOWzsJDQdWOhTJuK/img.png?width=1200&amp;height=600&amp;face=0_0_1200_600"><a href="https://github.com/LSH3333/spring5fs" target="_blank" rel="noopener" data-source-url="https://github.com/LSH3333/spring5fs">
<div class="og-image" style="background-image: url('https://scrap.kakaocdn.net/dn/bqvx9S/hyPeJVy1K8/PIsD4YzOWzsJDQdWOhTJuK/img.png?width=1200&amp;height=600&amp;face=0_0_1200_600');">&nbsp;</div>
<div class="og-text">
<p class="og-title" data-ke-size="size16">GitHub - LSH3333/spring5fs: 스프링5 프로그래밍 입문 (최범균 저)</p>
<p class="og-desc" data-ke-size="size16">스프링5 프로그래밍 입문 (최범균 저) . Contribute to LSH3333/spring5fs development by creating an account on GitHub.</p>
<p class="og-host" data-ke-size="size16">github.com</p>
</div>
</a></figure>
<p data-ke-size="size16">&nbsp;</p>
<p data-ke-size="size16">&nbsp;</p>
<p data-ke-size="size16">마지막으로 url 주소에 따라 해당 페이지가 어떤 과정을 거쳐 보이게 되는지 정리해볼까 한다.</p>
<p data-ke-size="size16">&nbsp;</p>
<h2 data-ke-size="size26"><b>메인&nbsp;</b></h2>
<p data-ke-size="size16">&nbsp;</p>
<p data-ke-size="size16"><b>http://localhost:8080/sp5-chap17/main</b></p>
<p><figure class="imageblock alignLeft" >
    <span data-lightbox="lightbox">
        <img src="./img/img.png"  />
    </span>
    <figcaption></figcaption>
</figure></p>
<p data-ke-size="size16">&nbsp;</p>
<p data-ke-size="size16">/main 경로는 컨트롤러 클래스에의해 처리되지 않고,<b> MvcConfig.java 클래스에 addViewControllers() 메소드에 의해 처리</b>된다. 해당 메서드는 WebMvcConfigurer에 정의되어 있는 메서드다.</p>
<pre id="code_1659008857494" class="java" data-ke-language="java" data-ke-type="codeblock"><code>	// WebMvcConfigurer 인터페이스에 정의됨 
	// 요청 경로 - 뷰 이름 연결 
	@Override 
	public void addViewControllers(ViewControllerRegistry registry) 
	{
		registry.addViewController("/main").setViewName("main");
	}</code></pre>
<p data-ke-size="size16">&nbsp;</p>
<p data-ke-size="size16"><b>main.jsp</b>는 다음과 같은데</p>
<div data-ke-type="moreLess" data-text-more="더보기" data-text-less="닫기">
<div class="moreless-content-ignore">
<pre id="code_1659009076422" data-ke-language="java" data-ke-type="codeblock"><code>&lt;%@ page contentType="text/html; charset=utf-8" %&gt;
&lt;%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %&gt;

&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
	&lt;title&gt;메인&lt;/title&gt;
&lt;/head&gt;

&lt;body&gt;
	&lt;%-- 로그인 성공했다면 HttpSession에 authInfo 객체 저장되어 있을것  --%&gt;
	&lt;%-- login 정보없음  --%&gt;
	&lt;c:if test="${empty authInfo }" &gt; 
	&lt;p&gt;환영합니다&lt;/p&gt;
	&lt;p&gt;
		&lt;a href="&lt;c:url value="/register/step1" /&gt;"&gt;[회원 가입하기]&lt;/a&gt;
		&lt;a href="&lt;c:url value="/login" /&gt;"&gt;[로그인]&lt;/a&gt;
	&lt;/p&gt;
	&lt;/c:if&gt;
	
	&lt;%-- login 정보있음  --%&gt; 
	&lt;c:if test="${!empty authInfo }" &gt;
	&lt;p&gt;${authInfo.name}님, 환영합니다. &lt;/p&gt;
	&lt;p&gt;
		&lt;a href="&lt;c:url value="/edit/changePassword"/&gt;"&gt;[비밀번호 변경]&lt;/a&gt;
		&lt;a href="&lt;c:url value="/logout"/&gt;"&gt;[로그아웃]&lt;/a&gt;
	&lt;/p&gt;
	&lt;/c:if&gt;

&lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
<p data-ke-size="size16">현재 로그인 안한 상태이므로, authInfo가 없어 [회원 가입하기]와 [로그인]이 보여진다.</p>
<p data-ke-size="size16">&nbsp;</p>
<hr contenteditable="false" data-ke-type="horizontalRule" data-ke-style="style3" />
<h2 data-ke-size="size26"><b>로그인</b></h2>
<p data-ke-size="size16">&nbsp;</p>
<p data-ke-size="size16"><b>[로그인]</b>을 눌르면 로그인 페이지로 넘어가고 해당 주소 요청은 <b>LoginController 클래스</b>의 @GetMapping을 갖는 form() 메서드가 처리하고 뷰이름으로 <b>login/loginForm.jsp</b>를 리턴한다.</p>
<p data-ke-size="size16">&nbsp;</p>
<p data-ke-size="size16"><b>http://localhost:8080/sp5-chap17/login</b></p>
<p><figure class="imageblock alignLeft" >
    <span data-lightbox="lightbox">
        <img src="./img/img_1.png"  />
    </span>
    <figcaption></figcaption>
</figure></p>
<p data-ke-size="size16"><b>loginForm.jsp</b></p>
<div data-ke-type="moreLess" data-text-more="더보기" data-text-less="닫기">
<div class="moreless-content-ignore">
<pre id="code_1659009581714" class="java" data-ke-language="java" data-ke-type="codeblock"><code>&lt;%@ page contentType="text/html; charset=EUC-KR" %&gt;
&lt;%@ taglib prefix="form" uri="http://www.springframework.org/tags/form" %&gt;
&lt;%@ taglib prefix="spring" uri="http://www.springframework.org/tags" %&gt;
    
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
	&lt;title&gt;&lt;spring:message code="login.title" /&gt;&lt;/title&gt;
&lt;/head&gt;

&lt;body&gt;

	&lt;form:form modelAttribute="loginCommand"&gt;
	&lt;form:errors /&gt;
	&lt;p&gt;
		&lt;label&gt;&lt;spring:message code="email" /&gt;:&lt;br&gt;
		&lt;form:input path="email" /&gt;
		&lt;form:errors path="email" /&gt;
		&lt;/label&gt;
	&lt;/p&gt;
	&lt;p&gt;
		&lt;label&gt;&lt;spring:message code="password" /&gt;:&lt;br&gt;
		&lt;form:input path="password" /&gt;
		&lt;form:errors path="password" /&gt;
		&lt;/label&gt;
	&lt;/p&gt;
	&lt;p&gt;
		&lt;label&gt;&lt;spring:message code="rememberEmail" /&gt;:&lt;br&gt;
		&lt;form:checkbox path="rememberEmail" /&gt;
		&lt;/label&gt;
	&lt;/p&gt;
	
	&lt;input type="submit" value="&lt;spring:message code="login.btn" /&gt;" /&gt;		
	&lt;/form:form&gt;
	
&lt;/body&gt;

&lt;/html&gt;</code></pre>
</div>
</div>
<p data-ke-size="size16">&nbsp;</p>
<p data-ke-size="size16">이메일 비밀번호를 입력해 로그인하기 버튼을 누르면 LoginController 클래스의 @PostMapping을 갖는 submit() 메서드의 <b>커맨드 객체 loginCommand에 정보들이 담기</b>고 정보에 따라 로그인 실패하면 뷰이름으로 login/loginForm을 리턴해 다시 로그인 페이지를 보여주고 성공했다면 뷰 이름으로 login/loginSuccess를 리턴해 보여준다.&nbsp;</p>
<p data-ke-size="size16">&nbsp;</p>
<p data-ke-size="size16">이메일과 비밀번호가 형식에 맞는지 확인은 LoginCommandValidator가 수행한다.</p>
<p data-ke-size="size16">&nbsp;</p>
<p data-ke-size="size16">이메일과 비밀번호를 DB의 데이터와 비교는 AuthService.authenticate() 메서드로 수행하고 수행과정에서 exception이 발생하면 <b>로그인이 실패</b>하게 된다.&nbsp;</p>
<p data-ke-size="size16">&nbsp;</p>
<p data-ke-size="size16"><b>로그인 성공</b> 판단시 커맨드 객체 LoginCommand에 rememberEmail 불린 값이 true라면 rememberCookie.setMaxAge()로 쿠키를 이용해 이메일을 30일 유지한다.</p>
<p data-ke-size="size16">&nbsp;</p>
<p data-ke-size="size16">또한 HttpSession.setAttribute() 메서드에 이름 "authInfo" 값 authInfo 객체를 저장해 세션을 유지한다.</p>
<p data-ke-size="size16">&nbsp;</p>
<p data-ke-size="size16">&nbsp;</p>
<p data-ke-size="size16">&nbsp;</p>
<p data-ke-size="size16">로그인 성공시 뷰이름 login/loginSuccess를 리턴해 로그인 성공을 보여주고&nbsp;</p>
<p><figure class="imageblock alignLeft" >
    <span data-lightbox="lightbox">
        <img src="./img/img_2.png"  />
    </span>
    <figcaption>로그인 성공</figcaption>
</figure></p>
<p data-ke-size="size16">이 상태에서 메인으로 이동하면&nbsp;</p>
<p><figure class="imageblock alignLeft" >
    <span data-lightbox="lightbox">
        <img src="./img/img_3.png"  />
    </span>
    <figcaption></figcaption>
</figure></p>
<p data-ke-size="size16">위와 같이 유저명, 환영합니다 가 보여지게 되는데, 이는 로그인 성공시 HttpSession.setAttribute()로 세션을 저장했기 떄문이다.</p>
<p data-ke-size="size16">main.jsp 에서 authInfo가 존재하기 때문에 이렇게 보여지게 된다.&nbsp;</p>
<p data-ke-size="size16">&nbsp;</p>
<hr contenteditable="false" data-ke-type="horizontalRule" data-ke-style="style3" />
<h2 data-ke-size="size26"><b>비밀번호 변경</b></h2>
<p data-ke-size="size16">[비밀번호 변경]을 누르면 "http://localhost:8080/sp5-chap17/edit/changePassword" 주소를 요청하게되고 이는 ChangePasswordController 클래스가 처리한다.</p>
<p><figure class="imageblock alignLeft" >
    <span data-lightbox="lightbox">
        <img src="./img/img_4.png"  />
    </span>
    <figcaption></figcaption>
</figure></p>
<p data-ke-size="size16">@GetMapping에 의해 리턴되는 뷰 이름은 "edit/changePwdForm"다.</p>
<p data-ke-size="size16"><b>edit/changePwdForm.jsp</b></p>
<div data-ke-type="moreLess" data-text-more="더보기" data-text-less="닫기">
<div class="moreless-content-ignore">
<pre id="code_1659010952058" class="java" data-ke-language="java" data-ke-type="codeblock"><code>&lt;%@ page contentType="text/html; charset=utf-8" %&gt;
&lt;%@ taglib prefix="form" uri="http://www.springframework.org/tags/form" %&gt;
&lt;%@ taglib prefix="spring" uri="http://www.springframework.org/tags" %&gt;

&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;title&gt;&lt;spring:message code="change.pwd.title" /&gt;&lt;/title&gt;
&lt;/head&gt;

&lt;body&gt;
	&lt;form:form&gt;
	&lt;p&gt;
		&lt;label&gt;&lt;spring:message code="currentPassword" /&gt;:&lt;br&gt;
		&lt;form:input path="currentPassword" /&gt;
		&lt;form:errors path="currentPassword" /&gt;
		&lt;/label&gt;
	&lt;/p&gt;
	&lt;p&gt;
		&lt;label&gt;&lt;spring:message code="newPassword" /&gt;:&lt;br&gt;
		&lt;form:input path="newPassword" /&gt;
		&lt;form:errors path="newPassword" /&gt;
		&lt;/label&gt;
	&lt;/p&gt;
	&lt;input type="submit" value="&lt;spring:message code="change.btn" /&gt;" &gt;
	&lt;/form:form&gt;
	
	
&lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
<p data-ke-size="size16">현재 비밀번호와 새 비밀번호를 입력해 [변경하기] 버튼을 누르면 ChangePwdController 클래스의 @PostMapping을 갖는 submit() 메서드에 의해 처리된다.&nbsp;</p>
<p data-ke-size="size16">&nbsp;</p>
<p data-ke-size="size16">입력한 값은 커맨드 객체인 ChangePwdCommand에 담겨있고 발생하는 에러가 없다면 현재 세션에 저장된 정보를 바탕으로 비밀번호를 변경하고 뷰 이름으로 "edit/changePwd"를 리턴한다.</p>
<p data-ke-size="size16">&nbsp;</p>
<p><figure class="imageblock alignLeft" >
    <span data-lightbox="lightbox">
        <img src="./img/img_5.png"  />
    </span>
    <figcaption></figcaption>
</figure></p>
<p data-ke-size="size16">&nbsp;</p>
<hr contenteditable="false" data-ke-type="horizontalRule" data-ke-style="style3" />
<p data-ke-size="size16">로그아웃 상태에서 메인에서<b> [회원 가입하기</b>]를 누르면 회원 가입 페이지로 이동한다.</p>
<p data-ke-size="size16">&nbsp;</p>
<h2 data-ke-size="size26"><b>회원 가입</b></h2>
<p data-ke-size="size16"><b>http://localhost:8080/sp5-chap17/register/step1</b></p>
<p><figure class="imageblock alignLeft" >
    <span data-lightbox="lightbox">
        <img src="./img/img_6.png"  />
    </span>
    <figcaption></figcaption>
</figure></p>
<p data-ke-size="size16">약관동의를 체크하고 [다음단계]를 누르면 step2로 이동된다.</p>
<p data-ke-size="size16">&nbsp;</p>
<p data-ke-size="size16"><b>http://localhost:8080/sp5-chap17/register/step2</b></p>
<p><figure class="imageblock alignLeft" >
    <span data-lightbox="lightbox">
        <img src="./img/img_7.png"  />
    </span>
    <figcaption></figcaption>
</figure></p>
<p data-ke-size="size16">&nbsp;</p>
<p data-ke-size="size16"><b>step2.jsp</b></p>
<div data-ke-type="moreLess" data-text-more="더보기" data-text-less="닫기">
<div class="moreless-content-ignore">
<pre id="code_1659011550574" class="java" data-ke-language="java" data-ke-type="codeblock"><code>&lt;%-- 입력 폼  --%&gt; 
&lt;%@ page contentType="text/html; charset=utf-8" %&gt;
&lt;%@ taglib prefix="form" uri="http://www.springframework.org/tags/form" %&gt;
&lt;%@ taglib prefix="spring" uri="http://www.springframework.org/tags" %&gt;

&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;&lt;spring:message code="member.register"/&gt;&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;

	&lt;h2&gt;&lt;spring:message code="member.info"/&gt;&lt;/h2&gt;
	&lt;form:form action="step3" modelAttribute="registerRequest"&gt;
	&lt;p&gt;
		&lt;label&gt;&lt;spring:message code="email"/&gt;:&lt;br&gt;
		&lt;form:input path="email" /&gt;
		&lt;form:errors path="email" /&gt;
		&lt;/label&gt;
	&lt;/p&gt;
	&lt;p&gt;
		&lt;label&gt;&lt;spring:message code="name"/&gt;:&lt;br&gt;
		&lt;form:input path="name" /&gt;
		&lt;form:errors path="name" /&gt;
		&lt;/label&gt;
	&lt;/p&gt;
	&lt;p&gt;
		&lt;label&gt;&lt;spring:message code="password"/&gt;:&lt;br&gt;
		&lt;form:password path="password" /&gt;
		&lt;form:errors path="password" /&gt;
		&lt;/label&gt;
	&lt;/p&gt;
	&lt;p&gt;
		&lt;label&gt;&lt;spring:message code="password.confirm"/&gt;:&lt;br&gt;
		&lt;form:password path="confirmPassword" /&gt;
		&lt;form:errors path="confirmPassword" /&gt;
		&lt;/label&gt;
	&lt;/p&gt;
	&lt;input type="submit" value="&lt;spring:message code="register.btn"/&gt;"&gt;
	&lt;/form:form&gt;

&lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
<p data-ke-size="size16">회원정보들을 입력후 [가입완료]를 누르면 요청은 &lt;form:form&gt; 태그의 속성 action="step3"로 인해 RegisterController 클래스의 @PostMapping("register/step3")를 갖는 handleStep3()로 전달되고 처리된다.</p>
<p data-ke-size="size16">&nbsp;</p>
<p data-ke-size="size16">&nbsp;</p>
<p data-ke-size="size16">&nbsp;</p>
                        </div>
                        <br/>
                        <div class="tags">
                            #Spring 
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
</div>
</body>
</html>
