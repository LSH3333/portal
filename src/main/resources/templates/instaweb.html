<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>InstaWeb</title>
    <link rel="stylesheet" type="text/css" href="/static/css/mainContentBlock.css"
        th:href="@{/css/mainContentBlock.css}" />
    <link rel="stylesheet" type="text/css" href="/static/css/footer.css" th:href="@{/css/footer.css}" />
    <link rel="stylesheet" type="text/css" href="/static/css/header.css" th:href="@{/css/header.css}" />
    <link rel="stylesheet" type="text/css" href="/static/css/instaweb.css" th:href="@{/css/instaweb.css}" />
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cedarville+Cursive&family=Noto+Sans+KR&display=swap"
        rel="stylesheet">
    <link
        href="https://fonts.googleapis.com/css2?family=Cedarville+Cursive&family=Noto+Sans+KR&family=Skranji&display=swap"
        rel="stylesheet">

    <!-- Font Awsome -->
    <script src="https://kit.fontawesome.com/c39d59a5ec.js" crossorigin="anonymous"></script>
</head>

<body>
    <!-- HEADER -->
    <header th:replace="fragment/header :: header"></header>

    <!-- MAIN -->
    <main>
        <!-- MainBlock1 -->
        <div id="mainBlock1">
            <div class="imgBlock">
                <img src="/static/images/instaweb.png" th:src="@{/images/instaweb.png}" alt="">
            </div>
            <div id="mainBlock1Content">
                <p>
                    로그인 후 글, 댓글을 작성할수 있는 웹.<br><br>
                    백엔드는 스프링, 데이터 저장은 jpa 를 사용했고 db는 postgresql, 클라이언트 사이드는 javascript, 프론트 디자인은 html 과 css 로 구현했습니다.
                    <!-- 서버 사이드는 Spring을 사용해 구현했고 클라이언트 사이드는 javascript, 프론트 디자인은 html 과 css 로 구현했습니다. -->
                    <br><br>
                    <a href="https://lsh-instaweb.herokuapp.com/" target="_blank"><i class="fa-solid fa-link"></i>visit
                        web →</a><br>
                    <a href="https://github.com/LSH3333/Instaweb" target="_blank"><i class="fa-brands fa-github"></i>
                        visit git →</a>
                </p>
                <div class="techStack">
                    <img src="/static/images/spring.svg" th:src="@{/images/spring.svg}" alt="">
                    <img src="/static/images/hibernate.svg" th:src="@{/images/hibernate.svg}" alt="">
                    <img src="/static/images/html.svg" th:src="@{/images/html.svg}" alt="">
                    <img src="/static/images/css.svg" th:src="@{/images/css.svg}" alt="">
                    <img src="/static/images/thymeleaf.svg" th:src="@{/images/thymeleaf.svg}" alt="">
                    <img src="/static/images/js.svg" th:src="@{/images/js.svg}" alt="">
                    <img src="/static/images/heroku.svg" th:src="@{/images/heroku.svg}" alt="">
                    <img src="/static/images/postgres.svg" th:src="@{/images/postgres.svg}" alt="">
                </div>
            </div>
        </div>
        <!-- mainContentBlock -->
        <div class="mainContentBlock" style="background-color: rgb(239, 239, 245); ">
            <div class="mainContentBlockWrap">
                <div class="ContentBlock">
                    <h2>도메인 모델</h2>
                    <hr>
                    <img src="/static/images/domainModel.jpg" th:src="@{/images/domainModel.jpg}" alt="">
                </div>
            </div>
        </div>
        <div class="mainContentBlock">
            <div class="mainContentBlockWrap">
                <div class="ContentBlock">
                    <h2>기술 스택</h2>
                    <hr>
                    <img src="/static/images/spring.svg" th:src="@{/images/spring.svg}" alt="">
                    <img src="/static/images/hibernate.svg" th:src="@{/images/hibernate.svg}" alt="">
                    <img src="/static/images/html.svg" th:src="@{/images/html.svg}" alt="">
                    <img src="/static/images/css.svg" th:src="@{/images/css.svg}" alt="">
                    <img src="/static/images/thymeleaf.svg" th:src="@{/images/thymeleaf.svg}" alt="">
                    <img src="/static/images/js.svg" th:src="@{/images/js.svg}" alt="">
                    <br>
                    <img src="/static/images/heroku.svg" th:src="@{/images/heroku.svg}" alt="">
                    <img src="/static/images/postgres.svg" th:src="@{/images/postgres.svg}" alt="">
                </div>
            </div>
        </div>
        <div class="mainContentBlock" style="background-color: rgb(239, 239, 245); ">
            <div class="mainContentBlockWrap">
                <div class="ContentBlock">
                    <h2>문제와 해결</h2>
                    <hr>
                    <h3>서버</h3>
                    <ul>
                        <li><b>서버와 클라이언트간의 통신</b></li>
                    </ul>
                    <p>처음에는 html 폼을 이용해서 데이터를 주고 받았는데, 주고 받아야 하는 데이터의 종류가 많아질수록
                        폼은 사용자에게 입력을 받는 용도로만 사용하고 ajax 로 모든 데이터를 주고 받는게 편하단것을 깨달았습니다.
                    </p>
                    <p>글 작성폼, 글 수정폼에서 사용자가 글을 작성하고 서버로 보내는경우 로직이 같기 때문에 ajax 로 통째로 받아서
                        데이터베이스에 저장하는 로직을 공유하도록 했습니다.
                    </p>
                    <a href="https://github.com/LSH3333/Instaweb/blob/cb653487036b3a75a5c75819e4abf4695c20fd11/src/main/java/web/instaweb/controller/PageController.java#L308-L355"
                        target="_blank">클라이언트에서 받은 데이터 저장</a>
                    <br><br>

                    <ul>
                        <li><b>이미지 저장에 대한 고민</b></li>
                    </ul>
                    <p>이미지를 어떤 방식으로 저장할지에 대한 고민이 있었습니다.</p>
                    <p>사실 처음에는 이미지를 base64 형식으로 글 내용에 삽입하는 방식으로 할까 생각했지만 이후
                        유저가 작성한 글을 수정하는 기능을 구현하면서 해당 방식으로는 html element 전체를 읽어서 base64인 이미지를 삭제하고 교체하는 복잡한 작업을 거쳐야 했기
                        때문에
                        이미지도 하나의 도메인으로 분리했습니다.
                    </p>
                    <a href="https://github.com/LSH3333/Instaweb/blob/cb653487036b3a75a5c75819e4abf4695c20fd11/src/main/java/web/instaweb/domain/Image.java#L10-L79"
                        target="_blank">이미지 도메인</a>
                    <br><br>

                    <ul>
                        <li><b>JPA의 연관관계</b></li>
                    </ul>
                    <p>트랜잭션 외부에서 객체를 갖고 왔을때 해당 객체와 연관관계에 있는 객체들에 대한 에러를 많이 경험했습니다.</p>
                    <p>원인은 객체와 연관관계에 있는 다른 객체를 가져올때 fetchType=LAZY 로 설정했기 때문인데 (LAZY 아닌 EAGER 설정 시 객체와 연관관계 있는 모든 객체
                        갖고오게됨)
                        개발을 하면서 트랜잭션 내부인 서비스 영역에서 모든 관계를 맺어준 후에 다른 영역에서 사용할수 있도록 변경했습니다.</p>
                    <a href="https://github.com/LSH3333/Instaweb/blob/cb653487036b3a75a5c75819e4abf4695c20fd11/src/main/java/web/instaweb/service/CommentService.java#L17-L40"
                        target="_blank">Service에서 연관관계 맺기</a>
                    <br><br>

                    <ul>
                        <li><b>폼과 DTO</b></li>
                    </ul>
                    <p>서버에서 클라이언트로 보내는 모든 데이터는 폼, DTO 로 보내도록 했습니다.</p>
                    <p>폼이나 DTO 를 사용하는 이유는 다음과 같습니다.</p>
                    <p>&nbsp;&nbsp;1. 엔티티 자체를 트랜잭션을 벗어나서 접근하는 경우 문제가 생깁니다. (fetch 타입이 lazy 일 경우)</p>
                    <p>&nbsp;&nbsp;2. 엔티티에 있는 맴버변수와 실제로 클라이언트쪽에서 사용할 맴버변수는 대부분의 경우 일부뿐입니다.</p>
                    <p>저는 클라이언트에서 사용자와 뭔가 상호작용이 있는 데이터들은 폼이라는 이름으로,</p>
                    <p>제가 직접 클라이언트에서 javascript 등으로 다뤄야 하거나 서버 내부 트랜잭션을 벗어나 다뤄야하는 데이터들은 DTO 라는 이름으로 전송했습니다.</p>
                    <a href="https://github.com/LSH3333/Instaweb/blob/a296d2413b51942f814136a1833db362d388ba3b/src/main/java/web/instaweb/controller/PageController.java#L159-L204"
                        target="_blank">DTO 로 데이터 받아 Wrap 후 클라이언트에 보내기</a><br>
                    <a href="https://github.com/LSH3333/Instaweb/blob/a296d2413b51942f814136a1833db362d388ba3b/src/main/java/web/instaweb/controller/PageController.java#L58-L62"
                        target="_blank">이미 저장된 작성중 글 존재하는 경우 해당 데이터 폼에 채워서 클라이언트에 보내기</a>
                    <br><br>

                    <h3>클라이언트</h3>
                    <h4>에디터</h4>
                    <img src="/static/images/instaweb_edit.png" th:src="@{/images/instaweb_edit.png}" alt="">
                    <p>생각보다 구현이 어려웠던 에디터입니다.</p><br>
                    <ul>
                        <li><b>글자크기,유형 변경 시 텍스트 드래그 영역 혹은 커서 위치 텍스트 식별</b></li>
                    </ul>
                    <p> javascript 의 selection, range api 로 식별 후 선택된 html element 저장 해놓은 후에, 사용자가 글자크기, 글자 유형 변경 버튼 클릭시
                        이전 선택된 element 들 style 변경 처리했습니다. </p>
                    <a href="https://github.com/LSH3333/Instaweb/blob/dd6dc38f09933af91270c3124fdc179c0fbbff80/src/main/resources/templates/fragment/editorData.html#L182-L201"
                        target="_blank">선택한 텍스트 크기 변경</a>

                    <br><br>

                    <ul>
                        <li><b>복사, 붙여넣기</b></li>
                    </ul>
                    <p>현재 페이지의 에디터에서 복사 한 경우, 외부 사이트에서 복사한 경우가 다른게 문제였습니다. </p>
                    <p>현재 페이지의 에디터에서의 복사는 저의 의도대로 에디터 내부의 html element 들이 복사되어 어렵지 않았지만 외부에서 복사한 경우 순수 문자열 형태로
                        복사 되었기 때문에 문자열을 분석해서 (링크인지, 순수 텍스트인지, &lt;script&gt 인지 등) 새로운 html element 를 조립해야 했습니다.
                    </p>
                    <a href="https://github.com/LSH3333/Instaweb/blob/85b098a3ed8da1dbe86df9914428463f688748b9/src/main/resources/templates/fragment/editorData.html#L271C6-L360"
                        target="_blank">붙여넣기 처리 함수</a>

                    <br><br>

                    <ul>
                        <li><b>이미지 로드 될때까지 대기해야 하는 문제</b></li>
                    </ul>
                    <p>예를들어 사용자가 글을 써내려가거나 개행 했을 시 에디터의 크기는 점점 커져야 합니다.</p>
                    <p>일반적인 상황에서는 문제가 없지만 이미지가 로드가 아직 다 안됐는데 에디터 크기 조절 연산을 하는 경우,
                        아직 이미지가 로드되지 않아 이미지의 크기가 포함되지 않는 문제가 있었습니다.</p>
                    <p>Promise 내부에서 이미지 모두 로드 됐는지 확인하고 로드 완료했다면 다음으로 진행, 아직이라면 다시 시도 하도록 했습니다. </p>
                    <a href="https://github.com/LSH3333/Instaweb/blob/70861f21f9cd46b404f6340cf7f566ac5c5b086c/src/main/resources/templates/fragment/editorData.html#L929-L959"
                        target="_blank">Promise 내부에서 이미지 로드 시도</a>

                </div>
            </div>
        </div>
    </main>

    <!-- FOOTER -->
    <footer th:replace="fragment/footer :: footer"></footer>
</body>

</html>